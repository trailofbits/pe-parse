__build_stage_script: &__build_stage_script
  stage: build
  language: cpp
  script:
    - mkdir build && cd build
    - cmake ..
    - make
  addons:
    apt:
      packages:
        - cmake
        - python2.7
        - python-dev
        - build-essential
        - realpath
        - libicu-dev
    homebrew:
      - cmake

jobs:
  include:
    - stage: lint
      language: minimal
      dist: bionic
      addons:
        apt:
          packages:
            - clang-format
      script:
        - find . \( -name '*.h' \) -or \( -name '*.cpp' \) | xargs clang-format -i -style=file
        - git diff --exit-code
    - <<: *__build_stage_script
      os: linux
      compiler: clang
    - <<: *__build_stage_script
      os: linux
      compiler: gcc
    - <<: *__build_stage_script
      os: osx
      compiler: clang
