jobs:
  include:
    - stage: lint
      os:
        - linux
      addons:
        apt:
          packages:
            - clang-format
      script:
        - clang-format -i -style=file pe-parser-library/{include,src}/**/*.{h,cpp}
        - git diff --exit-code
    - stage: build
      language: cpp
      os:
        - linux
        - osx
      compiler:
        - clang
        - gcc
      addons:
        homebrew:
          packages:
            - cmake
        apt:
          packages:
            - cmake
            - python2.7
            - python-dev
            - build-essential
            - realpath
            - libicu-dev
      matrix:
        exclude:
        - compiler: gcc
          os: osx
      script:
        - mkdir build && cd build
        - cmake ..
        - make

env:
  global:
  - secure: "O+BGqz4ugoVIJbQTh0dJjKRrsSVzkCYSe0WpRzEWK3l8Mw7hqX300g81TxRwTzN2zfUsROMzaeGaXWfGzYakgW59K1WIioaczxtv2MzzUQTbqzJPa+qQoP9bk/b2wJ5jcOL965/rudRju4UiIwuIgzDAMN3nAfIEJgV/2zANLIg="

addons:
  coverity_scan:
    project:
      name: "trailofbits/pe-parse"
      description: "Principled, lightweight C/C++ PE parser"
    notification_email: dan@trailofbits.com
    build_command: "./travis.sh linux build"
    branch_pattern: master
